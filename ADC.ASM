IO0SET          EQU   0xE0028004
IO0DIR          EQU   0xE0028008
IO0CLR          EQU   0xE002800C
VPBDIV          EQU  0xE01FC100
PINSEL1         EQU   0xE002C004
AD0CR           EQU   0xE0034000
AD0DR4          EQU   0xE0034020
IO0PIN          EQU   0xE0028000

	AREA ADC_,CODE,READONLY
	EXPORT __main
__main
	ENTRY
		LDR R0,=VPBDIV
		LDR R1,=0X02
		STR R1,[R0]
		
		LDR R0,=PINSEL1
		LDR R1,=0X00040000 ;SETS ADC CONFIG
		STR R1,[R0]
		
		LDR R0,=IO0DIR
		LDR R1,=0X30FF0000 ;0.28,0.29, 0.16-0.23 OUTPUT
		STR R1,[R0]
		
UP1		LDR R0,=AD0CR
		LDR R1,=0X00200410
		STR R1,[R0]
		
		;SET 24TH BIT OF AD0CR
		LDR R2,=1
		ORR R1,R2,LSL #24
		STR R1,[R0]
		
UP		LDR R0,=AD0DR4
		LDR R1,[R0]
		AND R2,R1,#0X80000000
		CMP R2,#0X80000000
		BNE UP
		MOV R1,R1,LSR #6
		LDR R3,=0X3FF
		AND R1,R1,R3 ;EXTRACTS LAST 10 BITS
		
		LDR R3,=310 ;1V
		CMP R1,R3
		BPL NXT1
		LDR R3,=0
		B CODE

NXT1	LDR R3,=621	; 2V
		CMP R1,R3
		BPL NXT2
		LDR R3,=0X10
		B CODE
NXT2	LDR R3,=931	; 3V
		CMP R1,R3
		BPL NXT3
		LDR R3,=0X20
		B CODE
NXT3	LDR R3,=1023	; 3.3V
		CMP R1,R3
		BPL NXT2
		LDR R3,=0X30
		B CODE
NXT4	LDR R3,=0X33

CODE	LDR R0,=SEG_CODEL
		AND R2,R3,#0X0F
		LDRB R1,[R0,R2]
		LDR R4,=0X20000000
		MOV R1,R1,LSL#16
		ORR R1,R1,R4
		LDR R0,=IO0PIN
		STR R1,[R0]
		BL DELAY
		LDR R0,=SEG_CODEU
		AND R2,R3,#0XF0
		MOV R2,R2,LSR#4
		LDRB R1,[R0,R2]
		LDR R4,=0X10000000
		MOV R1,R1,LSL#16
		ORR R1,R1,R4
		LDR R0,=IO0PIN
		STR R1,[R0]
		BL DELAY
		B UP1
DELAY
		LDR R10,=0X2FF
UP2		SUBS R10,R10,#1
		BNE UP2
		BX LR
		
SEG_CODEL	DCB 0X3F,0X06,0X5B,0X4F
SEG_CODEU	DCB	0XBF,0X86,0XDB,0XCF
		END