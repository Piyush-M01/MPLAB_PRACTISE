IO0DIR EQU 0XE0028008
IO0SET EQU 0XE0028004
IO0CLR EQU 0XE002800C
	
	AREA STEPPER,CODE,READONLY
	EXPORT __main
__main
	ENTRY
		LDR R0,=IO0DIR
		LDR R1,=IO0SET
		LDR R2,=IO0CLR
		LDR R3,=0X0000F000
		STR R3,[R0]
		;ALL COILS SET = MOTOR OFF
		STR R3,[R1]
START		
		LDR R4,=0X0000C000
		LDR R5,=0X00004000
FIRST	STR R4,[R2]
		LDR R6,=0X2FFFff
		B DELAY
DELAY	SUBS R6,R6,#1
		CMP R6,#0
		BNE DELAY
		STR R4,[R1]
		MOV R4,R4,LSR #1
		B SECOND
SECOND	STR R5,[R2]
		LDR R6,=0X2FFFff
		B DELAY1
DELAY1	SUBS R6,R6,#1
		CMP R6,#0
		BNE DELAY1
		STR R5,[R1]
		CMP R5,#0X00001000
		BEQ CHANGE
		MOV R5,R5,LSR #1
		B FIRST
		
CHANGE	LDR R4,=0X00009000
		STR R4,[R2]
		ldr r6,=0x2fffff
		B DELAY2
DELAY2	SUBS R6,R6,#1
		CMP R6,#0
		BNE DELAY2
		str r5,[r1]
		LDR R5,=0X00008000
		STR R5,[R2]
		B DELAY3
DELAY3	SUBS R6,R6,#1
		CMP R6,#0
		BNE DELAY3
		B START
		END